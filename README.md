Bambu Lab MQTT Light ControllerThis project transforms an ESP32 into a smart controller for your Bambu Lab 3D printer. It connects directly to the printer's local MQTT broker to monitor its status in real-time.It provides two primary functions:External Chamber Light: Controls a dimmable external light (like a 12V/24V LED strip) using a MOSFET, automatically syncing with the printer's light or manual overrides.WS2812B Status Bar: Drives a (FastLED) addressable LED strip to provide a clear visual indication of the printer's status (e.g., Idle, Printing, Paused, Error).The device hosts a full web interface for live status monitoring, manual control, and deep configuration.üåü Key FeaturesReal-Time MQTT Monitoring: Connects securely (SSL) to the printer's local MQTT broker to get instant status updates111111111.Full Web Interface: A responsive web UI to monitor printer status, control lights, and configure all settings2222.Dimmable External Light Control:Uses PWM for 0-100% brightness control of an external light3333.Supports both Active HIGH and Active LOW logic (invert output) to work with any MOSFET or relay module444444444.Auto Mode: Syncs with the printer's built-in light status5.Manual Control: Override the light (On/Off) from the web UI6666.Finish Timeout: Optionally keeps the light ON when a print finishes, then automatically turns it OFF after 2 minutes77777777.WS2812B (FastLED) Status Bar:Displays printer progress as a loading bar when printing8.Shows distinct colors for Idle, Paused, Error, and Finished states9999.All colors and brightness levels are fully customizable via the web UI10101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010.Optional 2-minute "Finish" light timeout before reverting to Idle status111111111111111111.Easy Setup & Configuration:Uses WiFiManager for initial setup. Just connect to the "BambuLightSetup" WiFi portal121212.All settings are stored in config.json on the ESP32's file system (LittleFS)131313131313131313.Configuration Web Page: A dedicated /config page to adjust all settings after initial setup14141414.System & Debugging:OTA Updates: Supports Over-the-Air firmware updates (hostname: bambu-light-controller)15151515151515.Factory Reset: Grounding a specific pin (GPIO 16) on boot will wipe all settings16161616161616161616161616161616.Backup/Restore: Download or upload your config.json file from the config page1717171717171717171717.MQTT History: A debug page (/mqtt) shows the last 100 raw messages received from the printer181818181818181818181818.Time Syncing: Uses an NTP server and configurable timezones to provide accurate timestamps in the logs191919191919191919.üîå Hardware Requirements & WiringESP32 Module: Any standard ESP32 development board (WROOM, etc.).External Light Hardware:A high-power 12V or 24V LED strip for chamber lighting.A logic-level N-Channel MOSFET module (like an IRF520) or a Relay Module to safely control the high-voltage light from the ESP32's 3.3V pin.Status Bar (Optional): A WS2812B (e.g., NeoPixel) addressable LED strip20202020.Reset Button (Optional): A momentary push button or jumper wire for the factory reset pin.Wiring DiagramESP32 PinConnects ToPurposeGPIO 4 (Hardcoded)WS2812B Data InFastLED Status Bar Data [cite: 3, 83, 98]GPIO 14 (Default)MOSFET/Relay Signal PinExternal Chamber Light Control[cite: 17, 80]. This pin is configurable in the web UI.GPIO 16 (Hardcoded)Momentary Button to GNDFactory Reset Pin[cite: 2, 58]. Ground this pin during boot to wipe settings.5V / VINMOSFET/Relay VCC, WS2812B +5VPower for modules (if 5V)GNDMOSFET/Relay GND, WS2812B GNDCommon GroundWarning: Do NOT power a WS2812B strip or a high-power chamber light directly from the ESP32's 5V or 3.3V pins. They require a separate, appropriately rated power supply. Always connect the grounds together.üöÄ Installation & Setup1. Find Your Printer's Network InfoYou need three pieces of information from your Bambu Lab printer:IP Address: (e.g., 192.168.1.100)Serial Number: (e.g., 01S00A000000000)Access Code: (Found in the printer's settings menu under Network -> WLAN -> Access Code)2. Flash the ESP32Open the BambuLed.ino file in the Arduino IDE.Select your ESP32 board from the "Tools" menu.Ensure you have the required libraries installed (e.g., WiFiManager, PubSubClient, ArduinoJson, FastLED, LittleFS).Compile and upload the sketch to your ESP32.3. Initial WiFi & MQTT ConfigurationOn its first boot (or after a factory reset), the ESP32 will not find any saved WiFi credentials21.On your phone or computer, scan for WiFi networks.Connect to the Access Point named "BambuLightSetup"22.Use the password "password"23.A captive portal (like a hotel WiFi login) should pop up automatically. If not, open a browser and go to http://192.168.4.1.Click "Configure WiFi".Select your home WiFi network (SSID) and enter its password.Crucially, fill in the custom parameters: 24242424Bambu Printer IPPrinter SerialAccess Code (MQTT Pass)Click "Save". The ESP32 will save all settings, connect to your WiFi, and reboot25252525.You can find the device's IP address from your router or by monitoring the Serial output in the Arduino IDE26.üñ•Ô∏è Using the Web InterfaceOnce connected, you can access the controller by visiting its IP address in a web browser.Status Page (/)This is the main dashboard, which auto-refreshes every 3 seconds27. It shows:Connection Status: WiFi network, device IP, and MQTT connection status28282828.Printer Status: Live GCODE state, print percentage, layer, time remaining, and temperatures 29292929.Light Status: The current state of your external light (On/Off, brightness) and the control mode (Auto/Manual)303030303030303030.LED Status: A text description of the LED bar's current state (e.g., "Printing (50%)") and a virtual preview bar313131313131313131.Manual Control: Buttons to turn the external light On, Off, or set it back to Auto mode32.Configuration Page (/config)This page allows you to change all device settings (except for WiFi) after the initial setup33333333.Printer Settings: Change the IP, Serial, or Access Code34.Time Settings: Set your NTP server and select your local Timezone for accurate logs35.External Light Settings:GPIO Pin: Change the pin used to control your light36.Brightness: Set the brightness (0-100%) for when the light is "On"37.Invert Logic: Check this if your MOSFET/relay is Active LOW38.Enable 2-Min Finish Timeout: Check to have the light turn off 2 minutes after a print finishes39.LED Status Bar Settings:Number of LEDs: Set how many WS2812B LEDs are in your strip40.Enable 2-Min Finish Timeout: Check to have the green "Finish" color revert to "Idle" after 2 minutes41.Live Preview: A virtual bar shows you what your LED settings will look like in each state42424242.LED States: Configure the hex color code (RRGGBB) and brightness (0-255) for all five printer states: Idle, Printing, Paused, Error, and Finish 43.Saving: Clicking "Save and Reboot" will store your new settings to config.json and reboot the ESP32 to apply them44444444.Backup & RestoreAt the bottom of the /config page, you can:Backup Configuration: Download a config.json file of all your current settings45454545.Restore Configuration: Upload a config.json file to restore settings. This will reboot the device464646464646464646.Debugging Pages/mqtt: Visit this page to see a history of the last 100 JSON messages received from the printer, with timestamps474747474747474747. This is extremely useful for debugging connection issues./status.json: This page provides the raw JSON data used to build the main status page48484848.üí° Troubleshooting & NotesHow to Change WiFi: You cannot change the WiFi network from the /config page. You must perform a Factory Reset.Factory Reset: To wipe all settings (WiFi, MQTT, pins, colors) and restart the WiFiManager portal, connect GPIO 16 to GND and then power on or reset the ESP3249494949494949494949494949494949.Over-the-Air (OTA) Updates: The device will appear in the Arduino IDE's "Network Ports" list with the hostname bambu-light-controller50. You can upload new firmware over WiFi. The LED strip will turn blue during the update51.Invalid GPIO Pin: The code includes checks to prevent using unsafe GPIO pins (like input-only or flash-reserved pins) 52525252. If you enter an invalid pin, it will be ignored or reverted to the default.
